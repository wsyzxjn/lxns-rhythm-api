
# 数据模型参考

<cite>
**本文档引用的文件**
- [models.ts](file://src/apis/maimai/models.ts)
- [Song.ts](file://src/apis/maimai/entities/Song.ts)
</cite>

## 目录
1. [玩家资料 (Player)](#玩家资料-player)
2. [成绩记录 (Score)](#成绩记录-score)
3. [收藏品通用结构 (Collection)](#收藏品通用结构-collection)
4. [Rating趋势 (RatingTrend)](#rating趋势-ratingtrend)
5. [枚举类型定义](#枚举类型定义)
6. [歌曲实体类 (Song)](#歌曲实体类-song)

## 玩家资料 (Player)

`Player` 接口定义了玩家的核心信息，包含游戏内名称、Rating、好友码以及外观装饰等属性。

| 字段 | 类型 | 可选 | 说明 |
|------|------|------|------|
| `name` | `string` | 否 | 游戏内显示的玩家昵称 |
| `rating` | `number` | 否 | 玩家当前的DX Rating值 |
| `friend_code` | `number` | 否 | 玩家的好友码，用于识别和添加好友 |
| `course_rank` | `number` | 否 | 段位ID，表示玩家在段位系统中的等级 |
| `class_rank` | `number` | 否 | 阶级ID，表示玩家的阶级等级 |
| `star` | `number` | 否 | 搭档觉醒数，反映搭档系统的进度 |
| `trophy` | `Trophy` | 是 | 玩家当前装备的称号信息 |
| `icon` | `Icon` | 是 | 玩家当前装备的头像信息 |
| `name_plate` | `NamePlate` | 是 | 玩家当前装备的姓名框信息 |
| `frame` | `Frame` | 是 | 玩家当前装备的背景信息 |
| `upload_time` | `string` | 是 | 玩家数据被同步到服务器的UTC时间（仅在获取时返回） |

**JSON示例**
```json
{
  "name": "玩家昵称",
  "rating": 15000,
  "friend_code": 12345678,
  "course_rank": 10,
  "class_rank": 5,
  "star": 3,
  "trophy": {
    "id": 101,
    "name": "传奇称号"
  },
  "icon": {
    "id": 201,
    "name": "传奇头像"
  },
  "name_plate": {
    "id": 301,
    "name": "传奇姓名框"
  },
  "frame": {
    "id": 401,
    "name": "传奇背景"
  }
}
```

**Section sources**
- [models.ts](file://src/apis/maimai/models.ts#L132-L149)

## 成绩记录 (Score)

`Score` 接口定义了玩家单曲成绩的详细信息，包括达成率、FC状态、DX分数等关键数据。

| 字段 | 类型 | 可选 | 说明 |
|------|------|------|------|
| `id` | `number` | 否 | 曲目ID，唯一标识一首歌曲 |
| `song_name` | `string` | 是 | 曲目名称（仅在获取时返回） |
| `level` | `string` | 是 | 难度标级，如"14+"（仅在获取时返回） |
| `level_index` | `LevelIndex` | 否 | 难度索引，对应BASIC(0)到RE_MASTER(4) |
| `achievements` | `number` | 否 | 达成率，以百分比数值存储（如99.5） |
| `fc` | `FCType \| null` | 是 | FULL COMBO状态，可能为null表示未达成 |
| `fs` | `FSType \| null` | 是 | FULL SYNC状态，可能为null表示未达成 |
| `dx_score` | `number` | 否 | DX分数，根据达成率计算得出 |
| `dx_star` | `number` | 是 | DX星级，最大值为5星 |
| `dx_rating` | `number` | 是 | 该成绩贡献的DX Rating值（向下取整） |
| `rate` | `RateType` | 是 | 评级类型，如"sssp"、"sss"等（仅在获取时返回） |
| `type` | `SongType` | 否 | 谱面类型，"standard"、"dx"或"utage" |
| `play_time` | `string` | 是 | 游玩的UTC时间，精确到分钟 |
| `upload_time` | `string` | 是 | 成绩被同步到服务器的UTC时间（仅在获取时返回） |
| `last_played_time` | `string` | 是 | 谱面最后游玩的UTC时间（特定接口返回） |

**JSON示例**
```json
{
  "id": 114,
  "song_name": "一首歌",
  "level": "14+",
  "level_index": 3,
  "achievements": 99.5,
  "fc": "fc",
  "fs": "fs",
  "dx_score": 990000,
  "dx_star": 5,
  "dx_rating": 25.0,
  "rate": "sssp",
  "type": "dx",
  "play_time": "2023-12-01T12:30:00Z"
}
```

**Section sources**
- [models.ts](file://src/apis/maimai/models.ts#L231-L282)

## 收藏品通用结构 (Collection)

`Collection` 接口是所有收藏品类别（称号、头像、姓名框、背景）的基础结构。

| 字段 | 类型 | 可选 | 说明 |
|------|------|------|------|
| `id` | `number` | 否 | 收藏品的唯一ID |
| `name` | `string` | 否 | 收藏品的名称 |
| `color` | `string` | 是 | 称号颜色（仅适用于称号类型） |
| `description` | `string` | 是 | 收藏品的说明文字 |
| `genre` | `string` | 是 | 收藏品分类（日文名称，称号除外） |
| `required` | `CollectionRequired[]` | 是 | 获取该收藏品所需满足的条件列表 |

`CollectionRequired` 定义了获取收藏品的具体要求：

| 字段 | 类型 | 可选 | 说明 |
|------|------|------|------|
| `difficulties` | `LevelIndex[]` | 是 | 要求的谱面难度数组，空数组代表任意难度 |
| `rate` | `RateType` | 是 | 要求的达成率等级 |
| `fc` | `FCType` | 是 | 要求的FULL COMBO状态 |
| `fs` | `FSType` | 是 | 要求的FULL SYNC状态 |
| `songs` | `CollectionRequiredSong[]` | 是 | 要求完成的曲目列表 |
| `completed` | `boolean` | 是 | 要求是否已全部完成的状态标志 |

`CollectionRequiredSong` 定义了具体曲目的要求：

| 字段 | 类型 | 可选 | 说明 |
|------|------|------|------|
| `id` | `number` | 否 | 曲目ID |
| `title` | `string` | 否 | 曲目名称 |
| `type` | `SongType` | 否 | 谱面类型 |
| `completed` | `boolean` | 是 | 该曲目要求是否已完成 |
| `completed_difficulties` | `LevelIndex[]` | 是 | 已完成的难度列表 |

**JSON示例**
```json
{
  "id": 101,
  "name": "挑战者称号",
  "color": "#FFD700",
  "description": "完成指定挑战获得",
  "genre": "称号",
  "required": [
    {
      "difficulties": [3, 4],
      "rate": "sssp",
      "fc": "fc",
      "songs": [
        {
          "id": 114,
          "title": "一首歌",
          "type": "dx",
          "completed": true,
          "completed_difficulties": [3]
        }
      ],
      "completed": false
    }
  ]
}
```

**Section sources**
- [models.ts](file://src/apis/maimai/models.ts#L158-L187)

## Rating趋势 (RatingTrend)

`RatingTrend` 接口用于表示玩家DX Rating随时间变化的数据点。

| 字段 | 类型 | 可选 | 说明 |
|------|------|------|------|
| `total` | `number` | 否 | 当日总DX Rating值 |
| `standard` | `number` | 否 | 旧版本谱面（标准版）贡献的DX Rating |
| `dx` | `number` | 否 | 现版本谱面（DX版）贡献的DX Rating |
| `date` | `string` | 否 | 日期，格式为YYYY-MM-DD |

此数据通常用于绘制Rating变化曲线图，帮助分析玩家的成长轨迹。

**JSON示例**
```json
{
  "total": 15000,
  "standard": 7000,
  "dx": 8000,
  "date": "2023-12-01"
}
```

**Section sources**
- [models.ts](file://src/apis/maimai/models.ts#L285-L299)

## 枚举类型定义

### LevelIndex (难度等级)

表示谱面的难度等级，从基础到究极。

| 值 | 说明 |
|----|------|
| `BASIC` (0) | 基础难度 |
| `ADVANCED` (1) | 进阶难度 |
| `EXPERT` (2) | 专家难度 |
| `MASTER` (3) | 大师难度 |
| `RE_MASTER` (4) | 究极难度 |

### RateType (达成率等级)

根据达成率划分的评级，从高到低排列。

| 值 | 对应达成率范围 | 说明 |
|----|----------------|------|
| `sssp` | ≥100.5% | SSS+ |
| `sss` | ≥100.0% | SSS |
| `ssp` | ≥99.5% | SS+ |
| `ss` | ≥99.0% | SS |
| `sp` | ≥98.0% | S+ |
| `s` | ≥97.0% | S |
| `aaa` | ≥94.0% | AAA |
| `aa` | ≥90.0% | AA |
| `a` | ≥80.0% | A |
| `bbb` | ≥75.0% | BBB |
| `bb` | ≥70.0% | BB |
| `b` | ≥60.0% | B |
| `c` | ≥50.0% | C |
| `d` | <50.0% | D |

### FCType (连击状态)

表示FULL COMBO的完成情况。

| 值 | 说明 |
|----|------|
| `app` | ALL PERFECT + PURE MEMORY |
| `ap` | ALL PERFECT |
| `fcp` | FULL COMBO + PURE MEMORY |
| `fc` | FULL COMBO |

### FSType (同步状态)

表示FULL SYNC的完成情况。

| 值 | 说明 |
|----|------|
| `fsdp` | FULL SYNC DELUXE + PURE MEMORY |
| `fsd` | FULL SYNC DELUXE |
| `fsp` | FULL SYNC + PURE MEMORY |
| `fs` | FULL SYNC |
| `sync` | SYNC |

**Section sources**
- [models.ts](file://src/apis/maimai/models.ts#L14-L213)

## 歌曲实体类 (Song)

位于 `entities/Song.ts` 的 `Song` 类是对 `models.ts` 中 `Song` 接口的实现，并提供了便捷的访问方式。

### 特殊性说明

`Song` 类不仅包含原始数据，还通过getter计算属性将数组形式的难度数据转换为对象映射，便于快速访问。其构造函数会处理可选字段的默认值。

### 计算属性

| 属性 | 返回类型 | 说明 |
|------|----------|------|
| `standard` | `{ basic?: SongDifficulty, advanced?: SongDifficulty, expert?: SongDifficulty, master?: SongDifficulty, rem