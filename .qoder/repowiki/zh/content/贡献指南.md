# 贡献指南

<cite>
**本文档引用的文件**
- [README.md](file://README.md)
- [eslint.config.ts](file://eslint.config.ts)
- [package.json](file://package.json)
- [tsup.config.ts](file://tsup.config.ts)
</cite>

## 目录
1. [简介](#简介)
2. [代码风格规范](#代码风格规范)
3. [分支管理策略](#分支管理策略)
4. [Pull Request 提交流程](#pull-request-提交流程)
5. [单元测试要求](#单元测试要求)
6. [版本发布规则](#版本发布规则)
7. [重大变更讨论](#重大变更讨论)

## 简介
欢迎参与 `lxns-rhythm-api` 项目的贡献！本指南旨在为社区成员提供清晰、一致的协作规范，帮助您顺利地为项目做出改进。我们鼓励所有开发者遵循以下约定，以确保代码质量、维护性以及团队协作效率。本文档内容与 `README.md` 保持一致，确保信息同步。

## 代码风格规范
为了保证代码库的一致性和可读性，项目强制执行统一的代码格式化和静态检查规则。

### 格式化工具：Prettier
所有 TypeScript 源码必须使用 **Prettier** 进行格式化。项目已配置 Prettier 规则，并通过 `package.json` 中的脚本集成：
```json
"scripts": {
  "prettier": "prettier --write 'src/**/*.ts'"
}
```
在提交代码前，请运行以下命令自动格式化源文件：
```bash
pnpm run prettier
```

### 静态检查：ESLint
项目使用 **ESLint** 结合 **@typescript-eslint** 插件进行类型安全和代码质量检查，配置文件位于 `eslint.config.ts`。该配置启用了推荐的 TypeScript 规则，并禁用了部分不适用的规则（如 `no-namespace`、`no-explicit-any`），同时集成了 `eslint-config-prettier` 以避免与 Prettier 的冲突。

#### 提交前检查
在提交代码之前，必须运行 ESLint 检查以确保无错误或警告：
```bash
pnpm run lint
```
此命令等价于：
```bash
eslint --ext .ts,.js src
```
请务必修复所有报告的问题后再提交 Pull Request。

**Section sources**
- [eslint.config.ts](file://eslint.config.ts#L0-L36)
- [package.json](file://package.json#L38-L40)

## 分支管理策略
项目采用基于 `main` 分支的特性分支开发模式，以确保主干稳定并支持并行开发。

### 创建特性分支
所有新功能或修复都应从最新的 `main` 分支拉取新的特性分支（feature branch）。建议命名格式为 `feature/your-feature-name` 或 `fix/issue-description`。

操作示例：
```bash
git checkout main
git pull origin main
git checkout -b feature/add-chuni-support
```

完成开发并通过本地测试后，推送分支并发起 Pull Request。

**Section sources**
- [README.md](file://README.md#L1)

## Pull Request 提交流程
提交高质量的 Pull Request 是保障项目健康发展的关键。请遵循以下要求：

### 清晰的描述
每个 Pull Request 必须包含详细的描述，说明：
- 修改的目的和背景
- 实现方案概述
- 影响范围（是否涉及 API 变更）
- 相关 Issue 编号（如有）

### UI 变更需附截图
如果您的更改涉及用户可见的接口（例如文档页面、CLI 输出等），请在 PR 描述中附上相关截图，以便审查者直观理解变更效果。

### 测试证明
所有逻辑变更必须附带相应的测试用例或证明其正确性的运行结果。对于新增功能，应提供单元测试；对于修复 bug，应提供复现问题及验证修复的证据。

**Section sources**
- [README.md](file://README.md#L1)

## 单元测试要求
项目高度重视代码的可测试性和稳定性。目前测试入口为 `tests/index.ts`，使用 `tsx` 执行测试脚本。

### 测试覆盖率
新增功能必须编写足够的单元测试，确保核心逻辑得到覆盖。虽然当前项目尚未强制要求覆盖率指标，但我们鼓励贡献者尽可能提高测试完整性。

### 测试运行方式
运行测试的命令如下：
```bash
pnpm run test
```
该命令会调用 `tsx tests/index.ts` 来执行测试脚本。

您可以在 `tests/` 目录下添加新的测试文件，并确保其能正常运行。

**Section sources**
- [package.json](file://package.json#L43)
- [tests/index.ts](file://tests/index.ts#L0-L6)

## 版本发布规则
项目遵循 **语义化版本号（Semantic Versioning）** 原则，版本格式为 `MAJOR.MINOR.PATCH`。

### 版本号含义
- **MAJOR**：当进行不兼容的 API 重大修改时递增
- **MINOR**：当以向后兼容的方式添加新功能时递增
- **PATCH**：当进行向后兼容的问题修复时递增

当前版本为 `0.1.4`，表示项目仍处于早期开发阶段（`MAJOR=0`），API 可能会发生变动。

### 自动化发布流程
`package.json` 中定义了 `prepublishOnly` 钩子，确保每次发布前自动执行格式化和构建：
```json
"prepublishOnly": "pnpm run prettier && pnpm run build"
```
这意味着在发布前会自动格式化代码并使用 `tsup` 构建输出文件。

构建配置由 `tsup.config.ts` 定义，采用 ES 模块格式输出至 `dist` 目录。

**Section sources**
- [package.json](file://package.json#L48-L49)
- [tsup.config.ts](file://tsup.config.ts#L0-L19)
- [package.json](file://package.json#L12)

## 重大变更讨论
对于可能影响 API 兼容性、架构设计或引入复杂功能的重大变更，我们强烈建议贡献者**先通过 GitHub Issues 进行讨论**。

### 讨论内容包括但不限于：
- 新增对 Chunithm API 的支持（见 TODO 列表）
- 修改客户端构造函数参数结构
- 引入新的依赖或构建工具

通过提前沟通，可以避免重复工作，获得社区反馈，并确保设计方案符合项目长期目标。

**Section sources**
- [README.md](file://README.md#L68-L70)